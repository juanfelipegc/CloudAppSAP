sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/Sorter","sap/ui/model/FilterOperator","sap/m/GroupHeaderListItem","sap/ui/Device","sap/ui/core/Fragment","../model/formatter"],function(t,e,i,s,r,a,o,n,l){"use strict";return t.extend("com.sap.ua.Gateway_352.controller.Master",{formatter:l,onInit:function(){var t=this.byId("list"),e=this._createViewModel(),i=t.getBusyIndicatorDelay();this._oList=t;this._oListFilterState={aFilter:[],aSearch:[]};this.setModel(e,"masterView");t.attachEventOnce("updateFinished",function(){e.setProperty("/delay",i)});this.getView().addEventDelegate({onBeforeFirstShow:function(){this.getOwnerComponent().oListSelector.setBoundMasterList(t)}.bind(this)});this.getRouter().getRoute("master").attachPatternMatched(this._onMasterMatched,this);this.getRouter().attachBypassed(this.onBypassed,this)},onUpdateFinished:function(t){this._updateListItemCount(t.getParameter("total"))},onSearch:function(t){if(t.getParameters().refreshButtonPressed){this.onRefresh();return}var e=t.getParameter("query");if(e){this._oListFilterState.aSearch=[new i("Company",r.Contains,e)]}else{this._oListFilterState.aSearch=[]}this._applyFilterSearch()},onRefresh:function(){this._oList.getBinding("items").refresh()},onOpenViewSettings:function(t){var e="filter";if(t.getSource()instanceof sap.m.Button){var i=t.getSource().getId();if(i.match("sort")){e="sort"}else if(i.match("group")){e="group"}}if(!this.byId("viewSettingsDialog")){n.load({id:this.getView().getId(),name:"com.sap.ua.Gateway_352.view.ViewSettingsDialog",controller:this}).then(function(t){this.getView().addDependent(t);t.addStyleClass(this.getOwnerComponent().getContentDensityClass());t.open(e)}.bind(this))}else{this.byId("viewSettingsDialog").open(e)}},onConfirmViewSettingsDialog:function(t){this._applySortGroup(t)},_applySortGroup:function(t){var e=t.getParameters(),i,r,a=[];i=e.sortItem.getKey();r=e.sortDescending;a.push(new s(i,r));this._oList.getBinding("items").sort(a)},onSelectionChange:function(t){var e=t.getSource(),i=t.getParameter("selected");if(!(e.getMode()==="MultiSelect"&&!i)){this._showDetail(t.getParameter("listItem")||t.getSource())}},onBypassed:function(){this._oList.removeSelections(true)},createGroupHeader:function(t){return new a({title:t.text,upperCase:false})},onNavBack:function(){history.go(-1)},_createViewModel:function(){return new e({isFilterBarVisible:false,filterBarLabel:"",delay:0,title:this.getResourceBundle().getText("masterTitleCount",[0]),noDataText:this.getResourceBundle().getText("masterListNoDataText"),sortBy:"Company",groupBy:"None"})},_onMasterMatched:function(){this.getModel("appView").setProperty("/layout","OneColumn")},_showDetail:function(t){var e=!o.system.phone;this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getRouter().navTo("object",{objectId:t.getBindingContext().getProperty("BusinessPartnerKey")},e)},_updateListItemCount:function(t){var e;if(this._oList.getBinding("items").isLengthFinal()){e=this.getResourceBundle().getText("masterTitleCount",[t]);this.getModel("masterView").setProperty("/title",e)}},_applyFilterSearch:function(){var t=this._oListFilterState.aSearch.concat(this._oListFilterState.aFilter),e=this.getModel("masterView");this._oList.getBinding("items").filter(t,"Application");if(t.length!==0){e.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataWithFilterOrSearchText"))}else if(this._oListFilterState.aSearch.length>0){e.setProperty("/noDataText",this.getResourceBundle().getText("masterListNoDataText"))}},_updateFilterBar:function(t){var e=this.getModel("masterView");e.setProperty("/isFilterBarVisible",this._oListFilterState.aFilter.length>0);e.setProperty("/filterBarLabel",this.getResourceBundle().getText("masterFilterBarText",[t]))}})});